<!doctype html>
<html lang="sv">
<head>
    <meta charset="utf-8" />

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-MRGMXGYLQV"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-MRGMXGYLQV');
    </script>

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
    <title>SharpRunner</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>

    <div id="langSwitcher" class="lang-switcher">
        <div class="lang-option" id="lang-sv" onclick="setLanguage('sv')" title="Svenska">
            <svg viewBox="0 0 16 10" preserveAspectRatio="none">
                <rect width="16" height="10" fill="#006aa7" />
                <rect width="2" height="10" x="5" fill="#fecc00" />
                <rect width="16" height="2" y="4" fill="#fecc00" />
            </svg>
        </div>
        <div class="lang-option" id="lang-en" onclick="setLanguage('en')" title="English">
            <svg viewBox="0 0 60 30" preserveAspectRatio="none">
                <rect width="60" height="30" fill="#012169" />
                <path d="M0,0 L60,30 M60,0 L0,30" stroke="#fff" stroke-width="6" />
                <path d="M0,0 L60,30 M60,0 L0,30" stroke="#C8102E" stroke-width="4" />
                <path d="M30,0 v30 M0,15 h60" stroke="#fff" stroke-width="10" />
                <path d="M30,0 v30 M0,15 h60" stroke="#C8102E" stroke-width="6" />
            </svg>
        </div>
    </div>

    <div id="gameHud" class="hud hidden">
        <div class="pill"><span data-t="hudTrack">BANA</span> <b id="hudTrackVal">001</b></div>
        <div class="pill"><span data-t="hudAttempts">F√ñRS√ñK</span> <b id="hudAttemptsVal">1</b></div>
        <div class="pill"><span data-t="hudDone">KLART</span> <b id="hudProgress">0%</b></div>
    </div>

    <div id="tutorialInstr" class="hidden">
        <div id="tutText" class="tut-text"></div>
    </div>

    <div id="scoutingHint" class="hidden">
        <div class="input-icons">
            <div class="key-cap">SPACE</div>
            <span class="touch-icon">üëÜ</span>
        </div>
        <div class="hint-text" data-t="skipHint">KLICKA F√ñR ATT HOPPA √ñVER</div>
    </div>

    <div id="progressBarContainer" class="hidden">
        <div id="progressBarFill"></div>
    </div>

    <button id="skipTutBtn" class="top-btn hidden" onclick="endTutorial()" data-t="skipTut">SKIPPA TUTORIAL</button>
    <button id="pauseBtn" class="top-btn hidden" onclick="togglePause()" data-t="pause">PAUS</button>

    <div id="mainMenu" class="screen">
        <h1 data-t="title">SharpRunner</h1>
        <button class="btn" onclick="showScreen('levelSelect')" data-t="startBtn">Starta Spelet</button>
        <button class="btn btn-tut" onclick="startTutorial()" data-t="tutBtn">Tutorial</button>
        <button class="btn btn-secondary" onclick="showScreen('statsScreen')" data-t="statsBtn">Statistik</button>
        <button class="btn btn-secondary" onclick="showScreen('settingsScreen')" data-t="settingsBtn">Inst√§llningar</button>
        <button class="btn btn-secondary" onclick="showScreen('aboutScreen')" data-t="aboutBtn">Om Oss</button>
        <button id="openSupportBtn" class="btn btn-secondary">Support</button>
        <button id="authMenuBtn" class="btn btn-secondary" onclick="openAuthModal()" data-t="loginBtn">LOGGA IN</button>
    </div>

    <div id="settingsScreen" class="screen hidden">
        <h1 data-t="settingsBtn">INST√ÑLLNINGAR</h1>
        <h2 data-t="skinTitle">V√ÑLJ F√ÑRG</h2>
        <div class="skin-grid" id="skinGrid"></div>
        <h2 data-t="speedTitle">SPELHASTIGHET</h2>
        <div class="range-container">
            <div id="speedValueDisplay">100%</div>
            <input type="range" id="speedRange" min="0.5" max="1.5" step="0.1" value="1" oninput="updateSpeedDisplay(this.value)" onchange="saveSpeedSetting(this.value)">
            <div style="display:flex; justify-content:space-between; color:#666; font-size:0.8rem; font-weight:bold;">
                <span>L√ÖNGSAMT</span><span>SNABBT</span>
            </div>
        </div>
        <h2 data-t="optionsTitle">ALTERNATIV</h2>
        <div class="toggle-container" onclick="toggleSound()">
            <div class="toggle-label" data-t="soundLabel">LJUD</div>
            <div class="toggle-btn" id="soundToggle"><div class="toggle-knob"></div></div>
        </div>
        <div class="toggle-container" onclick="toggleFog()">
            <div class="toggle-label" data-t="fogLabel">DIMMA (SV√ÖRT)</div>
            <div class="toggle-btn" id="fogToggle"><div class="toggle-knob"></div></div>
        </div>
        <div class="reset-section">
            <button class="btn btn-danger" onclick="resetGameData()" data-t="resetBtn" style="width:100%">RENSA DATA</button>
        </div>
        <button class="btn btn-secondary" style="margin-top: 25px;" onclick="showScreen('mainMenu')" data-t="back">Tillbaka</button>
    </div>

    <div id="levelSelect" class="screen hidden">
        <button class="btn btn-secondary" style="align-self: flex-start; min-width: 120px;" onclick="showScreen('mainMenu')" data-t="backMenu">‚Üê MENY</button>
        <h2 data-t="diffEasy">L√ÑTT</h2><div class="menu-grid" id="grid-easy"></div>
        <h2 data-t="diffMed">MEDEL</h2><div class="menu-grid" id="grid-medium"></div>

        <h2 style="color:var(--obstacle); border-color:var(--obstacle);">OBSTACLE (JUMP!)</h2><div class="menu-grid" id="grid-obstacle"></div>

        <h2 style="color:var(--dynamic); border-color:var(--dynamic);" data-t="diffDyn">DYNAMIC</h2><div class="menu-grid" id="grid-dynamic"></div>
        <h2 style="color:var(--mindflip); border-color:var(--mindflip);" data-t="diffMindflip">MINDFLIP</h2><div class="menu-grid" id="grid-mindflip"></div>
        <h2 style="color:var(--tricky); border-color:var(--tricky);" data-t="diffTricky">TRICKY</h2><div class="menu-grid" id="grid-tricky"></div>
        <h2 data-t="diffHard">SV√ÖR</h2><div class="menu-grid" id="grid-hard"></div>
        <h2 style="color:var(--brutal); border-color:var(--brutal);" data-t="diffBrut">BRUTAL</h2><div class="menu-grid" id="grid-brutal"></div>
    </div>

    <div id="pauseScreen" class="screen hidden" style="background: rgba(5,6,8,0.85); backdrop-filter: blur(5px); justify-content: center;">
        <h1 data-t="pausedTitle">PAUSAD</h1>
        <button class="btn" onclick="togglePause()" data-t="resumeBtn">√Öteruppta</button>
        <button class="btn btn-secondary" onclick="exitToMenu()" data-t="exitBtn">Avsluta till Meny</button>
    </div>

    <div id="statsScreen" class="screen hidden">
        <h1 data-t="statsBtn">STATISTIK</h1>
        <div class="stats-wrapper">
            <div class="arcade-hero">
                <div class="stat-box streak">
                    <span class="stat-val" id="stWinStreak">0</span>
                    <span class="stat-label" data-t="statStreak">WIN STREAK</span>
                </div>
                <div class="stat-box best">
                    <span class="stat-val" id="stBestStreak">0</span>
                    <span class="stat-label" data-t="statBestStreak">BEST STREAK</span>
                </div>
                <div class="stat-box deaths" style="grid-column: span 2;">
                    <span class="stat-val" id="stDeaths">0</span>
                    <span class="stat-label" data-t="statDeaths">TOTAL DEATHS</span>
                </div>
            </div>
            <div class="diff-breakdown" id="diffBreakdown"></div>
            <div class="stats-list" id="statsList"></div>
        </div>
        <button class="btn btn-secondary" style="margin-top: 25px;" onclick="showScreen('mainMenu')" data-t="back">Tillbaka</button>
    </div>

    <div id="aboutScreen" class="screen hidden" style="justify-content: center;">
        <h1 data-t="aboutBtn">OM OSS</h1>
        <div id="aboutContent"></div>
        <button class="btn btn-secondary" style="margin-top: 20px;" onclick="showScreen('mainMenu')">OK</button>
    </div>

    <div id="gameOverlay" class="overlay hidden">
        <div class="popup" id="popupBox">
            <h2 id="msgTitle">CRASH!</h2>
            <div id="progressInfo"></div>

            <div class="crash-progress-container">
                <div id="crashProgressBar" class="crash-progress-fill"></div>
            </div>

            <p id="msgBody"></p>
            <button id="overlayMainBtn" class="btn">N√ÑSTA</button>
            <button id="overlayExitBtn" class="btn btn-secondary" onclick="exitToMenu()" data-t="backMenu">MENY</button>
        </div>
    </div>

    <canvas id="c"></canvas>

    <div id="supportModal" style="display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 10000; justify-content: center; align-items: flex-start; padding-top: 20px; overflow-y: auto; backdrop-filter: blur(4px);">
        <div class="no-scrollbar" style="background: #0f172a; border: 1px solid #334155; padding: 30px; border-radius: 16px; width: 90%; max-width: 450px; color: white; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5); max-height: 90vh; overflow-y: auto;">

            <h2 data-t="supportTitle" style="text-align: center; margin-bottom: 10px; font-size: 1.5rem; letter-spacing: 1px;">SHARPRUNNER SUPPORT</h2>

            <div style="background: #1e293b; padding: 15px; border-radius: 8px; margin-bottom: 20px; font-size: 0.85rem; color: #cbd5e1; border-left: 4px solid #4f46e5;">
                <p data-t="supportInfo" style="margin-bottom: 8px;">Anv√§nd detta formul√§r f√∂r att rapportera buggar, skicka feedback eller √∂vriga fr√•gor som r√∂r spelet.</p>
                <p data-t="supportWarning" style="color: #fbbf24; font-weight: bold; margin: 0;">‚ö†Ô∏è OBS: Ange aldrig l√∂senord eller k√§nslig personlig information i beskrivningen.</p>
            </div>

            <p id="statusMessage" style="display: none; text-align: center; font-weight: bold; padding: 10px; border-radius: 8px; margin-bottom: 15px;"></p>

            <form id="supportForm" action="https://formspree.io/f/mjgerdge" method="POST" style="display: flex; flex-direction: column; gap: 15px;">

                <input type="text" name="_gotcha" style="display:none">
                <input type="hidden" name="Ticket_ID" id="ticketIdField">

                <div>
                    <label data-t="supportLabelTitle" style="font-size: 11px; font-weight: bold; color: #94a3b8; text-transform: uppercase; display: block; margin-bottom: 4px;">Titel *</label>
                    <input type="text" name="subject" data-t-placeholder="supportPlaceholderTitle" placeholder="Ange vad det g√§ller" required style="width: 100%; background: #1e293b; border: 1px solid #334155; color: white; padding: 12px; border-radius: 6px; font-size: 14px;">
                </div>

                <div>
                    <label data-t="supportLabelCategory" style="font-size: 11px; font-weight: bold; color: #94a3b8; text-transform: uppercase; display: block; margin-bottom: 4px;">√Ñrende *</label>
                    <select name="category" style="width: 100%; background: #1e293b; border: 1px solid #334155; color: white; padding: 12px; border-radius: 6px; font-size: 14px;">
                        <option value="[BUGG]" data-t="supportOptBug">Rapportera Bugg</option>
                        <option value="[FEEDBACK]" data-t="supportOptFeedback">Feedback / F√∂rslag</option>
                        <option value="[√ñVRIGT]" data-t="supportOptOther">√ñvrigt</option>
                    </select>
                </div>

                <div style="display: flex; gap: 10px;">
                    <div style="flex: 1;">
                        <label data-t="supportLabelName" style="font-size: 11px; font-weight: bold; color: #64748b; text-transform: uppercase; display: block; margin-bottom: 4px;">Namn (Valfritt)</label>
                        <input type="text" name="name" data-t-placeholder="supportPlaceholderName" placeholder="Ditt namn" style="width: 100%; background: #0f172a; border: 1px solid #334155; color: #cbd5e1; padding: 12px; border-radius: 6px; font-size: 14px;">
                    </div>
                </div>

                <div>
                    <label data-t="supportLabelEmail" style="font-size: 11px; font-weight: bold; color: #64748b; text-transform: uppercase; display: block; margin-bottom: 4px;">E-post (Valfritt)</label>
                    <input type="email" name="email" data-t-placeholder="supportPlaceholderEmail" placeholder="namn@exempel.se" style="width: 100%; background: #0f172a; border: 1px solid #334155; color: #cbd5e1; padding: 12px; border-radius: 6px; font-size: 14px;">
                    <p data-t="supportEmailHint" style="font-size: 10px; color: #64748b; margin-top: 4px; font-style: italic;">Fyll i om du vill ha m√∂jlighet till √•terkoppling. Svar kan ej garanteras.</p>
                </div>

                <div>
                    <label data-t="supportLabelDesc" style="font-size: 11px; font-weight: bold; color: #94a3b8; text-transform: uppercase; display: block; margin-bottom: 4px;">Beskrivning *</label>
                    <textarea name="message" data-t-placeholder="supportPlaceholderDesc" rows="4" placeholder="Beskriv ditt √§rende s√• detaljerat som m√∂jligt..." required style="width: 100%; background: #1e293b; border: 1px solid #334155; color: white; padding: 12px; border-radius: 6px; resize: none; font-size: 14px; font-family: sans-serif;"></textarea>
                </div>

                <div style="display: flex; gap: 10px; margin-top: 10px;">
                    <button type="submit" id="submitBtn" data-t="supportSubmitBtn" style="flex: 2; background: #4f46e5; color: white; border: none; padding: 14px; border-radius: 8px; cursor: pointer; font-weight: bold; letter-spacing: 0.5px; transition: background 0.2s;">SKICKA RAPPORT</button>
                    <button type="button" id="closeSupportBtn" data-t="supportCancelBtn" style="flex: 1; background: transparent; border: 1px solid #475569; color: #cbd5e1; padding: 14px; border-radius: 8px; cursor: pointer; font-weight: bold;">AVBRYT</button>
                </div>
            </form>
        </div>
    </div>

    <div id="authModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.85); z-index:10000; justify-content:center; align-items:flex-start; padding-top:20px; overflow-y:auto; backdrop-filter:blur(4px);">
        <div class="no-scrollbar" style="background:#0f172a; border:1px solid #334155; padding:30px; border-radius:16px; width:90%; max-width:420px; color:white; box-shadow:0 25px 50px -12px rgba(0,0,0,0.5); max-height:90vh; overflow-y:auto;">

            <h2 style="text-align:center; margin-bottom:20px; font-size:1.5rem; letter-spacing:1px;">SHARPRUNNER</h2>

            <!-- Flikar (login / register) -->
            <div id="authTabs" style="display:flex; gap:8px; margin-bottom:20px;">
                <button id="authTabLogin" class="btn btn-secondary active" style="flex:1; padding:10px;" onclick="showAuthView('login')" data-t="authLoginTab">LOGGA IN</button>
                <button id="authTabRegister" class="btn btn-secondary" style="flex:1; padding:10px;" onclick="showAuthView('register')" data-t="authRegisterTab">REGISTRERA</button>
            </div>

            <!-- Felmeddelande / bekr√§ftelse -->
            <p id="authMessage" style="display:none; text-align:center; font-weight:bold; padding:10px; border-radius:8px; margin-bottom:15px; font-size:0.85rem;"></p>

            <!-- VY: Logga in -->
            <div id="authView-login">
                <div style="display:flex; flex-direction:column; gap:14px;">
                    <div>
                        <label data-t="authEmailLabel" style="font-size:11px; font-weight:bold; color:#94a3b8; text-transform:uppercase; display:block; margin-bottom:4px;">E-POST</label>
                        <input id="loginEmail" type="email" data-t-placeholder="authPlaceholderEmail" placeholder="din@email.se" style="width:100%; background:#1e293b; border:1px solid #334155; color:white; padding:12px; border-radius:6px; font-size:14px;">
                    </div>
                    <div>
                        <label data-t="authPasswordLabel" style="font-size:11px; font-weight:bold; color:#94a3b8; text-transform:uppercase; display:block; margin-bottom:4px;">L√ñSENORD</label>
                        <input id="loginPassword" type="password" data-t-placeholder="authPlaceholderPassword" placeholder="Ditt l√∂senord" style="width:100%; background:#1e293b; border:1px solid #334155; color:white; padding:12px; border-radius:6px; font-size:14px;" onkeydown="if(event.key==='Enter') handleLogin()">
                    </div>
                    <button id="loginSubmitBtn" class="btn" style="width:100%; margin-top:4px;" onclick="handleLogin()" data-t="authLoginSubmit">LOGGA IN</button>
                    <div style="text-align:center; color:#475569; font-size:0.8rem; font-weight:bold; margin:4px 0;" data-t="authOr">ELLER</div>
                    <button class="btn btn-secondary" style="width:100%;" onclick="authSignInWithProvider('google')">Google</button>
                    <button class="btn btn-secondary" style="width:100%;" onclick="authSignInWithProvider('discord')">Discord</button>
                    <button class="btn btn-secondary" style="width:100%; margin-top:4px;" onclick="closeAuthModal()" data-t="authCancel">AVBRYT</button>
                </div>
            </div>

            <!-- VY: Registrera -->
            <div id="authView-register" class="hidden">
                <div style="display:flex; flex-direction:column; gap:14px;">
                    <div>
                        <label data-t="authUsernameLabel" style="font-size:11px; font-weight:bold; color:#94a3b8; text-transform:uppercase; display:block; margin-bottom:4px;">ANV√ÑNDARNAMN</label>
                        <input id="registerUsername" type="text" data-t-placeholder="authPlaceholderUsername" placeholder="V√§lj ett anv√§ndarnamn" style="width:100%; background:#1e293b; border:1px solid #334155; color:white; padding:12px; border-radius:6px; font-size:14px;">
                    </div>
                    <div>
                        <label data-t="authEmailLabel" style="font-size:11px; font-weight:bold; color:#94a3b8; text-transform:uppercase; display:block; margin-bottom:4px;">E-POST</label>
                        <input id="registerEmail" type="email" data-t-placeholder="authPlaceholderEmail" placeholder="din@email.se" style="width:100%; background:#1e293b; border:1px solid #334155; color:white; padding:12px; border-radius:6px; font-size:14px;">
                    </div>
                    <div>
                        <label data-t="authPasswordLabel" style="font-size:11px; font-weight:bold; color:#94a3b8; text-transform:uppercase; display:block; margin-bottom:4px;">L√ñSENORD</label>
                        <input id="registerPassword" type="password" data-t-placeholder="authPlaceholderPassword" placeholder="Ditt l√∂senord" style="width:100%; background:#1e293b; border:1px solid #334155; color:white; padding:12px; border-radius:6px; font-size:14px;" onkeydown="if(event.key==='Enter') handleRegister()">
                    </div>
                    <button id="registerSubmitBtn" class="btn" style="width:100%; margin-top:4px;" onclick="handleRegister()" data-t="authRegisterSubmit">SKAPA KONTO</button>
                    <div style="text-align:center; color:#475569; font-size:0.8rem; font-weight:bold; margin:4px 0;" data-t="authOr">ELLER</div>
                    <button class="btn btn-secondary" style="width:100%;" onclick="authSignInWithProvider('google')">Google</button>
                    <button class="btn btn-secondary" style="width:100%;" onclick="authSignInWithProvider('discord')">Discord</button>
                    <button class="btn btn-secondary" style="width:100%; margin-top:4px;" onclick="closeAuthModal()" data-t="authCancel">AVBRYT</button>
                </div>
            </div>

            <!-- VY: Inloggad / konto -->
            <div id="authView-account" class="hidden">
                <div style="display:flex; flex-direction:column; gap:14px; align-items:center;">
                    <p id="authAccountName" style="font-size:1.3rem; font-weight:bold; letter-spacing:1px; margin:10px 0;"></p>
                    <button class="btn btn-danger" style="width:100%;" onclick="handleSignOut()" data-t="authLogout">LOGGA UT</button>
                    <button class="btn btn-secondary" style="width:100%;" onclick="closeAuthModal()" data-t="authCancel">AVBRYT</button>
                </div>
            </div>

        </div>
    </div>

    <script src="js/constants.js"></script>
    <script src="js/audio.js"></script>
    <script src="js/settings.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/levels.js"></script>
    <script src="js/particles.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/game.js"></script>
    <script src="js/physics.js"></script>
    <script src="js/render.js"></script>
    <script src="js/main.js"></script>
    <script src="js/support.js"></script>

</body>
</html>
